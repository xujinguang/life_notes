## TCP

### 0. 基本知识

1. 它属于传输层协议（才外还有UDP），IP属于网络层协议
2. 面向连接 - 意思发送前需要建立发送双方的连接才能传输数据
3. 端到端 - 连接两端的数据通信
4. 可靠通信 - 分包编序，数据校验，丢包重传
5. 全双工 - 双方可以同时收发数据

对比来看，UDP传输协议是一种不可靠的、面向无连接、可以实现多对一、一对多和一对一连接的通信协议。这样就好理解了。好比理解黑，得知道白的含义。

### 1. 三次握手

（1）在建立通道时，客户端首先要向服务端发送一个SYN同步信号。

（2）服务端在接收到这个信号之后会向客户端发出SYN同步信号和ACK确认信号。

（3）当服务端的ACK和SYN到达客户端后，客户端与服务端之间的这个“通道”就会被建立起来。

#### 1.1 为什么是三次不是4次

因为中间避免一次握手：服务器回复的ACK数据包同时携带了SYN。所以变成了3次。

#### 1.2 为什么需要握手

建立对等端到端的双工通信通道连接。所以才有上面的各种特性考点。

### 2. 四次挥手

#### 2.1 为什么是4次而不是连接时候的3次？

不是因为不能“打顺风车”，而是因为客户端单方面关闭通信时，服务端可能还有数据要传输，不能假定服务端没有数据同时关闭。所以另外一端的关闭操作就根据自身需要而关闭了。这时候就是4个数据包了。全双工连接，两方各关闭一次，并ACK。

### 3. TIME_WAIT状态

### 4. RST包

- 端口未打开，Linux服务器会回包RST
-  设置了recv的超时时间，服务端会回RST
- 服务端提前关闭连接
-  客户端在服务端已经关闭掉socket之后，仍然在发送数据。这时服务端会产生RST。 

不会发送RST包情况

*  使用**shutdown、close**关闭套接字，发送的是FIN 
*   套接字关闭前，对运行的程序**Ctrl+C**，发送的是FIN 
*  套接字关闭前，执行**return、exit(0)、exit(1)**，会发送FIN 

