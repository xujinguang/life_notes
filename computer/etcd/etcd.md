## etcd

 一个高可用强一致性的键值仓库 。 最经典的使用场景就是服务发现。它的角色不是其他NoSQL产品的替代品， 默认处理的数据都是系统中的控制数据，比如配置。

### 特点

- 简单：易于部署，易使用。基于 HTTP+JSON 的 API 让你用 curl 就可以轻松使用。
- 安全：可选 SSL 客户认证机制。
- 快速：每个实例每秒支持一千次写操作。
- 高可用：使用一致性 Raft 算法充分实现了分布式。

### 组件

<img src="https://user-gold-cdn.xitu.io/2019/10/20/16de6f9b9563c22d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" style="zoom:50%;" /> 



### 要点
当集群初始化时候，每个节点都是Follower角色；
集群中存在至多1个有效的主节点，通过心跳与其他节点同步数据；
当Follower在一定时间内没有收到来自主节点的心跳，会将自己角色改变为Candidate，并发起一次选主投票；当收到包括自己在内超过半数节点赞成后，选举成功；当收到票数不足半数选举失败，或者选举超时。若本轮未选出主节点，将进行下一轮选举（出现这种情况，是由于多个节点同时选举，所有节点均为获得过半选票）。
Candidate节点收到来自主节点的信息后，会立即终止选举过程，进入Follower角色。为了避免陷入选主失败循环，每个节点未收到心跳发起选举的时间是一定范围内的随机值，这样能够避免2个节点同时发起选主。
### 应用场景
数据量较小的场景和控制数据存储场景
#### 1. 服务发现

 服务发现就是想要了解集群中是否有进程在监听 udp 或 tcp 端口，并且通过名字就可以查找和连接。需要以下能力支持，缺一不可。

1.  **一个强一致性、高可用的服务存储** 
2.  **一种注册服务和监控服务健康状态的机制**
3.  **一种查找和连接服务的机制** 

etcd就是它的可选实现之一。除此之外，可以使用zookeeper，redis。

场景一：服务发现（Service Discovery
场景二：消息发布与订阅
场景三：负载均衡
场景四：分布式通知与协调
场景五：分布式锁、分布式队列
场景六：集群监控与Leader竞选

### 参考资料

【1】[etcd](https://juejin.im/post/6844903970461351944)
[raft动画演示](http://thesecretlivesofdata.com/raft/)
